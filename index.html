<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ·å ±è¨­è¨ˆç¥å™¨ (æ——è‰¦ç‰ˆ)</title>
  
  <!-- 1. è¼‰å…¥ Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- 2. è¼‰å…¥ React èˆ‡ ReactDOM (Production ç‰ˆæœ¬) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- 3. è¼‰å…¥ Babel (è®“ç€è¦½å™¨çœ‹å¾—æ‡‚ JSX èªæ³•) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- å…¨åŸŸ CSS è¨­å®š -->
  <style>
    /* å¼•å…¥ 10 ç¨®ç²¾é¸ Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Klee+One:wght@400;600&family=Long+Cang&family=M+PLUS+Rounded+1c:wght@400;500;700&family=Ma+Shan+Zheng&family=Noto+Sans+TC:wght@300;400;500;700&family=Noto+Serif+TC:wght@400;700&family=Yusei+Magic&family=Zen+Maru+Gothic:wght@400;500;700&family=Zhi+Mang+Xing&display=swap');
    
    body { font-family: 'Noto Sans TC', sans-serif; margin: 0; padding: 0; }
    p, h2, span, label, input, textarea, select { font-family: 'Noto Sans TC', sans-serif; }
    
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.1); border-radius: 10px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.2); }
    
    /* è‡ªè¨‚ range slider æ¨£å¼è®“å®ƒæ›´ç²¾ç·» */
    input[type=range] {
      -webkit-appearance: none;
      background: transparent;
    }
    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none;
      height: 14px;
      width: 14px;
      border-radius: 50%;
      background: #4f46e5;
      cursor: pointer;
      margin-top: -5px;
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%;
      height: 4px;
      cursor: pointer;
      background: #e5e7eb;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <!-- React æ‡‰ç”¨ç¨‹å¼çš„æ›è¼‰é» -->
  <div id="root"></div>

  <!-- æ³¨æ„é€™è£¡çš„ type æ˜¯ text/babelï¼Œé€™æ˜¯çµ¦ Babel ç¿»è­¯ç”¨çš„ -->
  <script type="text/babel">
    const { useReducer, useRef, useCallback, useState, useEffect } = React;

    // ==========================================
    // 1. å­—å…¸èˆ‡è¨­å®š
    // ==========================================
    const LAYOUT_OPTIONS = {
      '1:1': { label: 'æ­£æ–¹å½¢ (1:1)', className: 'aspect-square w-[500px]' },
      '3:5': { label: 'ç›´å¼æµ·å ± (3:5)', className: 'aspect-[3/5] w-[450px]' },
      '5:3': { label: 'æ©«å¼æµ·å ± (5:3)', className: 'aspect-[5/3] w-[750px]' },
      'A4-portrait': { label: 'A4 ç›´å¼ (åˆ—å°ç´š)', className: 'aspect-[210/297] w-[600px]' },
      'A4-landscape': { label: 'A4 æ©«å¼ (åˆ—å°ç´š)', className: 'aspect-[297/210] w-[850px]' },
      'A3-portrait': { label: 'A3 ç›´å¼ (é«˜è§£æ)', className: 'aspect-[210/297] w-[800px]' },
      'A3-landscape': { label: 'A3 æ©«å¼ (é«˜è§£æ)', className: 'aspect-[297/210] w-[1130px]' }
    };

    const THEME_OPTIONS = {
      shinkai: { name: 'å”¯ç¾ (æ–°æµ·èª )', bg: 'https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-black/10' },
      cyberpunk: { name: 'éœ“è™¹ (é›»å¹»)', bg: 'https://images.unsplash.com/photo-1555861496-faa2e7174fa4?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-purple-900/40' },
      minimal: { name: 'ç´”ç²¹ (æ¥µç°¡)', bg: 'https://images.unsplash.com/photo-1495195129352-aeb325a55b65?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-white/20' },
      nature: { name: 'ç”Ÿæ©Ÿ (è‡ªç„¶)', bg: 'https://images.unsplash.com/photo-1511497584788-876760111969?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-green-900/30' },
      midnight: { name: 'åˆå¤œ (æ·±é‚ƒ)', bg: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-blue-900/50' },
      solitude: { name: 'å­¤å¯‚ (é»‘ç™½)', bg: 'https://images.unsplash.com/photo-1447752875215-b2761acb3c5d?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-black/60' },
      passion: { name: 'ç†±æƒ… (èŠ±ç«)', bg: 'https://images.unsplash.com/photo-1533613220915-609f661a6fe1?auto=format&fit=crop&q=80&w=2000', overlay: 'bg-red-900/40' },
      custom: { name: 'âœ¨ è‡ªè¨‚åœ–ç‰‡', bg: '', overlay: 'bg-black/30' }
    };

    const RECOMMENDATION_LOGIC = [
      { words: ['å…‰', 'é™½', 'å¤¢', 'æ„›', 'æš–', 'å¸Œæœ›', 'ç¾'], recs: ['shinkai', 'minimal', 'passion'] },
      { words: ['å¤œ', 'æœˆ', 'æ˜Ÿ', 'æ·±', 'å†·', 'æš—', 'å­¤', 'å¯‚'], recs: ['midnight', 'cyberpunk', 'solitude'] },
      { words: ['å±±', 'æ£®', 'è‰', 'æœ¨', 'ç”Ÿ', 'è‡ªç„¶', 'ç¶ ', 'æµ·'], recs: ['nature', 'minimal', 'shinkai'] },
    ];

    // æ“´å……ç‚º 10 ç¨®å­—é«”
    const FONT_OPTIONS = {
      sans: { label: 'æ¨™æº–é»‘é«” (Sans)', value: "'Noto Sans TC', sans-serif" },
      serif: { label: 'å„ªé›…æ˜é«” (Serif)', value: "'Noto Serif TC', serif" },
      rounded: { label: 'å¯æ„›åœ“é«” (Rounded)', value: "'M PLUS Rounded 1c', sans-serif" },
      zenMaru: { label: 'å¾©å¤åœ“é«” (Zen Maru)', value: "'Zen Maru Gothic', sans-serif" },
      handwriting: { label: 'æ—¥ç³»æ‰‹å¯« (Klee)', value: "'Klee One', cursive" },
      yusei: { label: 'éº¥å…‹ç­† (Yusei)', value: "'Yusei Magic', sans-serif" },
      pixel: { label: 'åƒç´ é¢¨ (Pixel)', value: "'DotGothic16', sans-serif" },
      brush: { label: 'è±ªæ”¾æ¯›ç­† (Zhi Mang)', value: "'Zhi Mang Xing', cursive" },
      longCang: { label: 'ç€Ÿç‘è‰æ›¸ (Long Cang)', value: "'Long Cang', cursive" },
      maShan: { label: 'åšé‡æ¯›ç­† (Ma Shan)', value: "'Ma Shan Zheng', cursive" }
    };

    // ==========================================
    // 2. ç‹€æ…‹ç®¡ç† (Reducer)
    // ==========================================
    const initialState = {
      draft: {
        // ä¸»æ¨™é¡Œ
        title: "å¿ƒä¹‹å‹‡å£«",
        titleSize: 42,
        titleColor: "#ffffff",
        titleFont: "serif", // é è¨­æ˜é«”
        
        // ç·¨è™Ÿ
        number: "227",
        numberSize: 24,
        numberColor: "#e5e7eb",
        numberFont: "sans",
        
        // å‰¯æ¨™é¡Œ
        subtitle: "å±•ç¾çµ¦å­©å­çš„é¢¨æ™¯",
        subtitleSize: 24,
        subtitleColor: "#ffffff",
        subtitleFont: "sans",
        
        // å…§æ–‡
        content: "æ³¨è¦–å­©å­å€‘çš„çœ¼ç› â€”â€” \né‚£æ˜¯å……æ»¿ç´”çœŸå’Œå¥½å¥‡çš„å¿ƒéˆä¹‹çª—ã€‚\nç•¶é‚£çª—å£æ‰“é–‹å‘è‘—æˆ‘å€‘çš„æ™‚å€™ï¼Œ\næˆ‘å€‘æ˜¯å¦æ‡‰è©²è² è²¬å‘é‚£çª—å£å±•ç¾ä»€éº¼ï¼Ÿ",
        contentSize: 18,
        contentColor: "#ffffff",
        contentFont: "sans",

        layout: "1:1",
        theme: "shinkai",
        qrUrl: "https://google.com",
        showQr: false,
        boxAlign: 'center',
        boxValign: 'center',
        offsetX: 0,
        offsetY: 0,
        boxWidth: 100
      },
      preview: null, 
    };

    function generatorReducer(state, action) {
      switch (action.type) {
        case 'UPDATE_FIELD':
          return { ...state, draft: { ...state.draft, [action.payload.name]: action.payload.value } };
        case 'SET_THEME':
          return { ...state, draft: { ...state.draft, theme: action.payload } };
        case 'GENERATE_PREVIEW':
          return { ...state, preview: { ...state.draft } };
        default:
          return state;
      }
    }

    // ==========================================
    // 3. ä¸»å…ƒä»¶
    // ==========================================
    function GeneratorApp() {
      const cardRef = useRef(null);
      const uploadedImageRef = useRef(""); 
      
      const [isSidebarOpen, setIsSidebarOpen] = useState(true); 
      const [isExporting, setIsExporting] = useState(false);
      const [exportImageUrl, setExportImageUrl] = useState(null);
      const [qrBase64, setQrBase64] = useState(""); 
      const [recommendedKeys, setRecommendedKeys] = useState(['shinkai', 'minimal', 'cyberpunk']);

      const [state, dispatch] = useReducer(generatorReducer, initialState);
      const { draft } = state;
      const activePreview = state.preview || state.draft; 

      useEffect(() => {
        const fullText = `${draft.title} ${draft.subtitle} ${draft.content}`;
        let found = false;
        for (const group of RECOMMENDATION_LOGIC) {
          if (group.words.some(word => fullText.includes(word))) {
            setRecommendedKeys(group.recs);
            found = true;
            break;
          }
        }
        if (!found) setRecommendedKeys(['shinkai', 'minimal', 'cyberpunk']);
      }, [draft.title, draft.subtitle, draft.content]);

      useEffect(() => {
        if (!activePreview.showQr || !activePreview.qrUrl) {
          setQrBase64("");
          return;
        }
        const generateQR = async () => {
          try {
            const url = `https://quickchart.io/qr?text=${encodeURIComponent(activePreview.qrUrl)}&size=200&margin=1`;
            const res = await fetch(url);
            const blob = await res.blob();
            const reader = new FileReader();
            reader.onloadend = () => setQrBase64(reader.result);
            reader.readAsDataURL(blob);
          } catch (err) { console.error('QR Code ç”¢ç”Ÿå¤±æ•—:', err); }
        };
        const timeoutId = setTimeout(() => generateQR(), 500);
        return () => clearTimeout(timeoutId);
      }, [activePreview.qrUrl, activePreview.showQr]);

      const handleChange = (e) => {
        const { name, value, type, checked } = e.target;
        dispatch({ 
          type: 'UPDATE_FIELD', 
          payload: { name, value: type === 'checkbox' ? checked : value } 
        });
      };

      const handleGridClick = (v, h) => {
        handleChange({ target: { name: 'boxValign', value: v }});
        handleChange({ target: { name: 'boxAlign', value: h }});
      };

      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        if (!file.type.startsWith('image/')) return alert('è«‹ä¸Šå‚³åœ–ç‰‡æª”æ¡ˆï¼');
        if (file.size > 5 * 1024 * 1024) return alert('åœ–ç‰‡å¤§å°è«‹å‹¿è¶…é 5MBï¼');

        const reader = new FileReader();
        reader.onload = (event) => {
          uploadedImageRef.current = event.target.result;
          dispatch({ type: 'SET_THEME', payload: 'custom' });
        };
        reader.readAsDataURL(file);
      };

      const handleGenerate = () => dispatch({ type: 'GENERATE_PREVIEW' });

      const generateExportImage = useCallback(async () => {
        if (cardRef.current === null) return;
        try {
          setIsExporting(true);
          if (!window.html2canvas) {
            await new Promise((resolve, reject) => {
              const script = document.createElement('script');
              script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
              script.onload = resolve;
              script.onerror = reject;
              document.head.appendChild(script);
            });
          }
          const canvas = await window.html2canvas(cardRef.current, {
            useCORS: true,
            scale: 2,
            backgroundColor: null
          });
          setExportImageUrl(canvas.toDataURL('image/png'));
        } catch (err) {
          console.error('åŒ¯å‡ºå¤±æ•—:', err);
          alert('åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
        } finally {
          setIsExporting(false);
        }
      }, []);

      const getActiveBgImage = () => {
        if (activePreview.theme === 'custom' && uploadedImageRef.current) return uploadedImageRef.current;
        return THEME_OPTIONS[activePreview.theme].bg;
      };

      const getContainerClasses = () => {
        const vMap = { top: 'items-start', center: 'items-center', bottom: 'items-end' };
        const hMap = { left: 'justify-start', center: 'justify-center', right: 'justify-end' };
        return `${vMap[activePreview.boxValign]} ${hMap[activePreview.boxAlign]}`;
      };

      return (
        <div className="min-h-screen bg-gray-50 flex flex-col md:flex-row text-left overflow-hidden">
          
          {/* ================= å·¦å´ï¼šç·¨è¼¯å™¨é¢æ¿ Wrapper ================= */}
          <div className={`relative shrink-0 transition-all duration-500 ease-in-out z-20 bg-white ${isSidebarOpen ? 'w-full md:w-[420px] h-screen border-r shadow-sm' : 'w-full h-14 md:w-0 md:h-screen border-r-0'}`}>
            
            {/* çœŸæ­£çš„ Sidebar å…§å®¹å®¹å™¨ */}
            <div className={`absolute inset-0 overflow-hidden transition-opacity duration-300 ${isSidebarOpen ? 'opacity-100 pointer-events-auto' : 'opacity-0 pointer-events-none'}`}>
              <div className="w-[100vw] md:w-[420px] h-full flex flex-col">
                <div className="p-6 border-b bg-white z-10 shrink-0">
                  <h2 className="text-xl font-black text-gray-900 tracking-wider">ğŸ¨ æµ·å ±è¨­è¨ˆç¥å™¨ (æ——è‰¦ç‰ˆ)</h2>
                </div>
                
                <div className="flex-1 overflow-y-auto p-5 space-y-8 custom-scrollbar bg-gray-50/30">
                  {/* å€å¡Š 1ï¼šç‰ˆé¢èˆ‡ AI é¢¨æ ¼ */}
                  <section className="space-y-4">
                    <h3 className="text-xs font-bold text-indigo-600 uppercase tracking-widest border-b pb-2">1. ç•«å¸ƒèˆ‡é¢¨æ ¼</h3>
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">ç•«å¸ƒæ¯”ä¾‹</label>
                      <select name="layout" value={draft.layout} onChange={handleChange} className="w-full p-2 border rounded-lg bg-white outline-none focus:ring-2 focus:ring-indigo-500">
                        {Object.entries(LAYOUT_OPTIONS).map(([key, opt]) => (
                          <option key={key} value={key}>{opt.label}</option>
                        ))}
                      </select>
                    </div>
                    
                    <div className="space-y-2">
                      <label className="block text-sm font-medium text-gray-700">
                        AI æ¨è–¦é¢¨æ ¼ <span className="text-xs text-gray-400 font-normal ml-1">(ä¾æ“šå…§æ–‡è‡ªå‹•åµæ¸¬)</span>
                      </label>
                      <div className="grid grid-cols-3 gap-2">
                        {recommendedKeys.map(key => (
                          <button 
                            key={key} onClick={() => dispatch({ type: 'SET_THEME', payload: key })}
                            className={`px-2 py-3 text-xs font-medium rounded-lg border transition-all flex flex-col items-center justify-center gap-1 ${
                              draft.theme === key ? 'bg-indigo-50 border-indigo-500 text-indigo-700 shadow-sm' : 'bg-white border-gray-200 text-gray-600 hover:bg-gray-50'
                            }`}
                          >
                            {THEME_OPTIONS[key].name.split(' ')[0]}
                          </button>
                        ))}
                      </div>
                      
                      <div className="flex items-center gap-2 pt-2">
                        <select name="theme" value={draft.theme} onChange={handleChange} className="flex-1 p-2 text-sm border rounded-lg bg-white outline-none focus:ring-2 focus:ring-indigo-500">
                          {Object.entries(THEME_OPTIONS).map(([key, opt]) => (
                            <option key={key} value={key}>{opt.name}</option>
                          ))}
                        </select>
                        <label className="cursor-pointer px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-100 transition text-sm bg-white shrink-0">
                          <input type="file" accept="image/*" onChange={handleImageUpload} className="hidden" />
                          è‡ªè¨‚åœ–ç‰‡
                        </label>
                      </div>
                    </div>
                  </section>

                  {/* å€å¡Š 2ï¼šè‡ªç”±æ’ç‰ˆ (9å®®æ ¼) */}
                  <section className="space-y-4">
                    <h3 className="text-xs font-bold text-indigo-600 uppercase tracking-widest border-b pb-2">2. è‡ªç”±æ’ç‰ˆ</h3>
                    
                    <div className="flex items-start gap-5">
                      <div className="shrink-0 space-y-1">
                        <label className="block text-xs text-center text-gray-500 mb-2">å°é½Šä½ç½®</label>
                        <div className="grid grid-cols-3 gap-1 w-24">
                          {['top', 'center', 'bottom'].map(v => (
                            ['left', 'center', 'right'].map(h => (
                              <button 
                                key={`${v}-${h}`} onClick={() => handleGridClick(v, h)}
                                className={`h-7 rounded border transition-all ${
                                  draft.boxValign === v && draft.boxAlign === h ? 'bg-indigo-500 border-indigo-600' : 'bg-white border-gray-300 hover:border-indigo-400'
                                }`}
                              />
                            ))
                          ))}
                        </div>
                      </div>

                      <div className="flex-1 space-y-4 pt-2">
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1"><span>Xè»¸ä½ç§»</span><span>{draft.offsetX}px</span></div>
                          <input type="range" name="offsetX" min="-400" max="400" value={draft.offsetX} onChange={handleChange} className="w-full" />
                        </div>
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1"><span>Yè»¸ä½ç§»</span><span>{draft.offsetY}px</span></div>
                          <input type="range" name="offsetY" min="-400" max="400" value={draft.offsetY} onChange={handleChange} className="w-full" />
                        </div>
                        <div>
                          <div className="flex justify-between text-xs text-gray-500 mb-1"><span>å€å¡Šå¯¬åº¦</span><span>{draft.boxWidth}%</span></div>
                          <input type="range" name="boxWidth" min="20" max="100" value={draft.boxWidth} onChange={handleChange} className="w-full" />
                        </div>
                      </div>
                    </div>
                  </section>

                  {/* å€å¡Š 3ï¼šæ–‡å­—è¨­å®š (æ¯å€‹æ¬„ä½ç¨ç«‹å­—é«”/é¡è‰²/å¤§å°) */}
                  <section className="space-y-4">
                    <h3 className="text-xs font-bold text-indigo-600 uppercase tracking-widest border-b pb-2">3. ç¨ç«‹æ–‡å­—è¨­å®š</h3>

                    {/* ä¸»æ¨™é¡Œå€å¡Š */}
                    <div className="p-3 bg-white border rounded-xl shadow-sm">
                      <div className="flex justify-between items-center mb-2">
                        <label className="text-sm font-bold text-gray-700">ä¸»æ¨™é¡Œ</label>
                        <div className="flex items-center gap-2">
                          <select name="titleFont" value={draft.titleFont} onChange={handleChange} className="p-1 text-xs border rounded bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 max-w-[130px] truncate">
                            {Object.entries(FONT_OPTIONS).map(([key, opt]) => <option key={key} value={key}>{opt.label}</option>)}
                          </select>
                          <input type="color" name="titleColor" value={draft.titleColor} onChange={handleChange} className="w-6 h-6 rounded cursor-pointer border border-gray-200 p-0 shrink-0" title="æ–‡å­—é¡è‰²" />
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mb-3">
                        <span className="text-[10px] text-gray-400">Aa</span>
                        <input type="range" name="titleSize" min="16" max="140" value={draft.titleSize} onChange={handleChange} className="flex-1" />
                        <span className="text-xs text-gray-500 w-6 text-right">{draft.titleSize}</span>
                      </div>
                      <input type="text" name="title" value={draft.title} onChange={handleChange} placeholder="è¼¸å…¥ä¸»æ¨™é¡Œ..." className="w-full p-2 border rounded-lg bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 text-sm" />
                    </div>

                    {/* ç·¨è™Ÿå€å¡Š */}
                    <div className="p-3 bg-white border rounded-xl shadow-sm">
                      <div className="flex justify-between items-center mb-2">
                        <label className="text-sm font-bold text-gray-700">ç·¨è™Ÿ (é™„å±¬æ¨™é¡Œ)</label>
                        <div className="flex items-center gap-2">
                          <select name="numberFont" value={draft.numberFont} onChange={handleChange} className="p-1 text-xs border rounded bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 max-w-[130px] truncate">
                            {Object.entries(FONT_OPTIONS).map(([key, opt]) => <option key={key} value={key}>{opt.label}</option>)}
                          </select>
                          <input type="color" name="numberColor" value={draft.numberColor} onChange={handleChange} className="w-6 h-6 rounded cursor-pointer border border-gray-200 p-0 shrink-0" title="æ–‡å­—é¡è‰²" />
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mb-3">
                        <span className="text-[10px] text-gray-400">Aa</span>
                        <input type="range" name="numberSize" min="12" max="80" value={draft.numberSize} onChange={handleChange} className="flex-1" />
                        <span className="text-xs text-gray-500 w-6 text-right">{draft.numberSize}</span>
                      </div>
                      <input type="text" name="number" value={draft.number} onChange={handleChange} placeholder="è¼¸å…¥ç·¨è™Ÿ..." className="w-full p-2 border rounded-lg bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 text-sm" />
                    </div>

                    {/* å‰¯æ¨™é¡Œå€å¡Š */}
                    <div className="p-3 bg-white border rounded-xl shadow-sm">
                      <div className="flex justify-between items-center mb-2">
                        <label className="text-sm font-bold text-gray-700">å‰¯æ¨™é¡Œ</label>
                        <div className="flex items-center gap-2">
                          <select name="subtitleFont" value={draft.subtitleFont} onChange={handleChange} className="p-1 text-xs border rounded bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 max-w-[130px] truncate">
                            {Object.entries(FONT_OPTIONS).map(([key, opt]) => <option key={key} value={key}>{opt.label}</option>)}
                          </select>
                          <input type="color" name="subtitleColor" value={draft.subtitleColor} onChange={handleChange} className="w-6 h-6 rounded cursor-pointer border border-gray-200 p-0 shrink-0" title="æ–‡å­—é¡è‰²" />
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mb-3">
                        <span className="text-[10px] text-gray-400">Aa</span>
                        <input type="range" name="subtitleSize" min="12" max="100" value={draft.subtitleSize} onChange={handleChange} className="flex-1" />
                        <span className="text-xs text-gray-500 w-6 text-right">{draft.subtitleSize}</span>
                      </div>
                      <input type="text" name="subtitle" value={draft.subtitle} onChange={handleChange} placeholder="è¼¸å…¥å‰¯æ¨™é¡Œ..." className="w-full p-2 border rounded-lg bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 text-sm" />
                    </div>

                    {/* å…§æ–‡å€å¡Š */}
                    <div className="p-3 bg-white border rounded-xl shadow-sm">
                      <div className="flex justify-between items-center mb-2">
                        <label className="text-sm font-bold text-gray-700">å…§æ–‡æ®µè½</label>
                        <div className="flex items-center gap-2">
                          <select name="contentFont" value={draft.contentFont} onChange={handleChange} className="p-1 text-xs border rounded bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500 max-w-[130px] truncate">
                            {Object.entries(FONT_OPTIONS).map(([key, opt]) => <option key={key} value={key}>{opt.label}</option>)}
                          </select>
                          <input type="color" name="contentColor" value={draft.contentColor} onChange={handleChange} className="w-6 h-6 rounded cursor-pointer border border-gray-200 p-0 shrink-0" title="æ–‡å­—é¡è‰²" />
                        </div>
                      </div>
                      <div className="flex items-center gap-2 mb-3">
                        <span className="text-[10px] text-gray-400">Aa</span>
                        <input type="range" name="contentSize" min="10" max="80" value={draft.contentSize} onChange={handleChange} className="flex-1" />
                        <span className="text-xs text-gray-500 w-6 text-right">{draft.contentSize}</span>
                      </div>
                      <textarea name="content" rows="4" value={draft.content} onChange={handleChange} placeholder="è¼¸å…¥å…§æ–‡ (æ”¯æ´æ›è¡Œ)..." className="w-full p-2 border rounded-lg bg-gray-50 resize-none outline-none focus:ring-2 focus:ring-indigo-500 text-sm"></textarea>
                    </div>
                  </section>

                  {/* å€å¡Š 4ï¼šé™„åŠ åŠŸèƒ½ */}
                  <section className="space-y-4 pb-4">
                    <h3 className="text-xs font-bold text-indigo-600 uppercase tracking-widest border-b pb-2">4. é™„åŠ åŠŸèƒ½</h3>
                    <div className="p-3 border rounded-lg bg-white">
                      <label className="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" name="showQr" checked={draft.showQr} onChange={handleChange} className="w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500" />
                        <span className="text-sm font-medium text-gray-700">ğŸ”— å•Ÿç”¨è¡Œå‹•å‘¼ç±² QR Code</span>
                      </label>
                      {draft.showQr && (
                        <input type="text" name="qrUrl" value={draft.qrUrl} onChange={handleChange} placeholder="è¼¸å…¥ç¶²å€å°‡è‡ªå‹•ç”¢ç”Ÿ QR Code" className="w-full p-2 mt-3 text-sm border rounded-lg bg-gray-50 outline-none focus:ring-2 focus:ring-indigo-500" />
                      )}
                    </div>
                  </section>
                </div>

                {/* åº•éƒ¨æŒ‰éˆ•å€ */}
                <div className="p-4 border-t bg-white flex gap-3 z-10 shrink-0">
                  <button onClick={handleGenerate} className="flex-1 py-3 bg-gray-900 text-white font-bold rounded-lg hover:bg-gray-800 transition shadow-md">
                    âœ¨ ç”¢ç”Ÿé è¦½
                  </button>
                  <button onClick={generateExportImage} disabled={isExporting} className="flex-1 py-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition shadow-md disabled:opacity-50">
                    {isExporting ? 'è™•ç†ä¸­...' : 'ğŸ“¸ å°å‡ºåœ–å¡'}
                  </button>
                </div>
              </div>
            </div>

            {/* é›»è…¦ç‰ˆï¼šæ”¶ç´åˆ‡æ›æŒ‰éˆ• */}
            <button 
              onClick={() => setIsSidebarOpen(!isSidebarOpen)}
              className="hidden md:flex absolute top-1/2 -right-6 w-6 h-16 bg-white border border-gray-200 border-l-0 items-center justify-center rounded-r-xl transform -translate-y-1/2 z-50 hover:bg-gray-50 transition-colors shadow-[2px_0_5px_rgba(0,0,0,0.05)] cursor-pointer"
            >
              <span className="text-gray-400 text-[10px] font-black">{isSidebarOpen ? 'â—€' : 'â–¶'}</span>
            </button>

            {/* æ‰‹æ©Ÿç‰ˆï¼šæ”¶åˆæ™‚é¡¯ç¤ºçš„å°æ¨™é¡Œåˆ— */}
            {!isSidebarOpen && (
              <div className="md:hidden absolute inset-0 bg-white border-b flex items-center justify-between px-6 z-30">
                <h2 className="text-sm font-black text-gray-900 tracking-wider">ğŸ¨ æµ·å ±è¨­è¨ˆç¥å™¨</h2>
                <button onClick={() => setIsSidebarOpen(true)} className="px-4 py-1.5 bg-indigo-50 text-indigo-600 text-xs font-bold rounded-full">
                  å±•é–‹ç·¨è¼¯å™¨
                </button>
              </div>
            )}
          </div>

          {/* ================= å³å´ï¼šé è¦½é¢æ¿ ================= */}
          <div className="flex-1 bg-gray-200 p-8 flex items-center justify-center overflow-x-hidden overflow-y-auto relative">
            <div className="transform scale-75 md:scale-100 origin-center transition-all duration-500">
              
              <div 
                ref={cardRef} 
                className={`relative flex p-12 bg-cover bg-center shadow-2xl overflow-hidden transition-all duration-700 ${LAYOUT_OPTIONS[activePreview.layout].className} ${getContainerClasses()}`}
                style={{ backgroundImage: `url(${getActiveBgImage()})` }}
              >
                {/* é®ç½© */}
                <div className={`absolute inset-0 pointer-events-none ${THEME_OPTIONS[activePreview.theme].overlay}`}></div>

                {/* å¡ç‰‡æœ¬é«” (å¥—ç”¨æ’ç‰ˆåƒæ•¸) */}
                <div 
                  className="relative z-10 backdrop-blur-md bg-white/20 border border-white/30 rounded-3xl p-10 shadow-2xl flex flex-col justify-between transition-all duration-300"
                  style={{ 
                    width: `${activePreview.boxWidth}%`,
                    transform: `translate(${activePreview.offsetX}px, ${activePreview.offsetY}px)`
                  }}
                >
                  <div>
                    <div className="mb-6">
                      {/* ä¸»æ¨™é¡Œèˆ‡ç·¨è™Ÿå¥—ç”¨ç¨ç«‹æ¨£å¼ */}
                      <h1 className="font-bold leading-tight transition-all duration-300" style={{ color: activePreview.titleColor, fontSize: `${activePreview.titleSize}px`, fontFamily: FONT_OPTIONS[activePreview.titleFont].value }}>
                        {activePreview.title} <span className="opacity-70 transition-all duration-300" style={{ color: activePreview.numberColor, fontSize: `${activePreview.numberSize}px`, fontFamily: FONT_OPTIONS[activePreview.numberFont].value }}>/ {activePreview.number}</span>
                      </h1>
                    </div>
                    {/* åˆ†éš”ç·šé¡è‰²è·Ÿéš¨ä¸»æ¨™é¡Œ */}
                    <div className="w-16 h-1 mb-6 opacity-50 transition-colors duration-300" style={{ backgroundColor: activePreview.titleColor }}></div>
                    
                    {/* å‰¯æ¨™é¡Œå¥—ç”¨ç¨ç«‹æ¨£å¼ */}
                    <h2 className="font-medium mb-6 tracking-wide transition-all duration-300" style={{ color: activePreview.subtitleColor, fontSize: `${activePreview.subtitleSize}px`, fontFamily: FONT_OPTIONS[activePreview.subtitleFont].value }}>
                      {activePreview.subtitle}
                    </h2>
                    
                    {/* å…§æ–‡å¥—ç”¨ç¨ç«‹æ¨£å¼ */}
                    <div className="space-y-4">
                      <p className="leading-relaxed font-light whitespace-pre-line transition-all duration-300" style={{ color: activePreview.contentColor, fontSize: `${activePreview.contentSize}px`, fontFamily: FONT_OPTIONS[activePreview.contentFont].value }}>
                        {activePreview.content}
                      </p>
                    </div>
                  </div>

                  {/* QR Code */}
                  {activePreview.showQr && qrBase64 && (
                    <div className="mt-8 flex items-center gap-4 pt-6 border-t border-white/20">
                      <div className="p-2 bg-white rounded-xl shadow-md shrink-0">
                        <img src={qrBase64} alt="QR Code" className="w-16 h-16 md:w-20 md:h-20 object-contain" />
                      </div>
                      <div className="flex flex-col justify-center">
                        <span className="text-sm md:text-base font-bold tracking-widest uppercase transition-colors duration-300" style={{ color: activePreview.contentColor, fontFamily: FONT_OPTIONS[activePreview.contentFont].value }}>Scan Me</span>
                        <span className="text-xs md:text-sm opacity-70 mt-1 transition-colors duration-300" style={{ color: activePreview.contentColor, fontFamily: FONT_OPTIONS[activePreview.contentFont].value }}>æƒæç²å–æ›´å¤šè³‡è¨Š</span>
                      </div>
                    </div>
                  )}
                </div>
              </div>

            </div>
          </div>

          {/* å°å‡ºé è¦½ Modal Overlay */}
          {exportImageUrl && (
            <div className="fixed inset-0 z-[100] bg-black/95 flex flex-col items-center justify-center p-4 backdrop-blur-xl animate-in fade-in duration-300">
              <div className="relative max-w-full">
                <img src={exportImageUrl} alt="Export" className="max-h-[75vh] md:max-h-[85vh] rounded-xl shadow-2xl border border-white/20 object-contain" />
                <div className="absolute -top-3 -right-3 bg-indigo-600 text-white text-[10px] font-black px-3 py-1 rounded-full shadow-lg border border-white/20">
                  ULTRA HD
                </div>
              </div>
              <p className="mt-6 text-gray-400 text-xs tracking-[0.2em] font-light text-center">
                ğŸ“± æ‰‹æ©Ÿç‰ˆè«‹ <strong className="text-white">é•·æŒ‰åœ–ç‰‡</strong> å„²å­˜åœ–å¡<br/>
                ğŸ’» é›»è…¦ç‰ˆè«‹ <strong className="text-white">å³éµå¦å­˜åœ–ç‰‡</strong>
              </p>
              <button 
                onClick={() => setExportImageUrl(null)} 
                className="mt-6 px-10 py-3 bg-white/10 hover:bg-white/20 text-white font-bold rounded-full border border-white/20 transition-all text-sm tracking-widest"
              >
                è¿”å›ç·¨è¼¯å™¨
              </button>
            </div>
          )}
        </div>
      );
    }

    // ==========================================
    // 4. æ›è¼‰ React æ‡‰ç”¨ç¨‹å¼
    // ==========================================
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<GeneratorApp />);
  </script>
</body>
</html>
